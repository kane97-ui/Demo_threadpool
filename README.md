## 线程池

使用多个线程，无限制循环等待队列，进行计算和操作。帮助快速降低和减少性能损耗（特别是当我们每个线程的任务处理⽐较快时，系统 ⼤部分性能消耗都花在了pthread_create以及释放线程的过程中。那既然是这样的话，何不在程序开始运⾏阶段提前创建好⼀堆线程）。线程池是提前创建并维护多个线程，等待管理者分配任务的机制，避免短时间线程创建和销毁的代价，一般是IO密集型的场景使用。主要包括线程管理器、任务线程、消息队列

例如，在网络通信中，线程池中的队列就维护了客户端的connect，write，send等请求，各个线程就互斥的获取线程池中的资源，并进行处理。其中各个线程会循环执行队列中的资源。

### 线程池的组成

1. 线程池管理器：初始化和创建线程，启动和停止线程，调配任务；管理线程池
2. 工作线程：线程池中等待并执行分配的任务
3. 任务接口：添加任务的接口，以提供工作线程调度任务的执行。
4. 任务队列：用于存放没有处理的任务，提供一种缓冲机制，同时具有调度功能，高优先级的任务放在队列前面

### 线程池的实现

* 设置一个生产者消费者作为临界资源
* 初始化n个线程，让其运行起来，加锁去任务队列中运行
* 当初始化任务队列为空时，所有线程阻塞
* 当生产者队列来了一个任务后，先对队列加锁，把任务挂在队列上，然后使用条件变量去通知阻塞中的线程。

### 解决的问题

1、解决任务处理，单线程处理比较慢。

2、阻塞IO 

3、解决线程创建于销毁的成本问题 

4、管理线程，能够动态的添加删除线程。

![image-20220727205314338](/Users/kane/Library/Application Support/typora-user-images/image-20220727205314338.png)

